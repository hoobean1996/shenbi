# Internationalization (i18n) Guide

This document explains how to use and extend the i18n system in Shenbi.

## Overview

Shenbi uses a custom React Context-based i18n system supporting:
- **Languages**: English (`en`) and Chinese (`zh`)
- **Nested translation keys**: `'nav.home'`, `'blocks.forward'`
- **Automatic persistence**: Language preference saved to storage
- **Fallback**: Falls back to English if a key is missing in the current language

## File Structure

```
src/i18n/
├── index.ts              # Exports
├── translations.ts       # All translation strings
└── LanguageContext.tsx   # React Context and hooks
```

## Using Translations in Components

### Basic Usage with `useLanguage`

```tsx
import { useLanguage } from '../i18n';

function MyComponent() {
  const { t, language, setLanguage } = useLanguage();

  return (
    <div>
      <h1>{t('nav.home')}</h1>
      <p>Current language: {language}</p>
      <button onClick={() => setLanguage('zh')}>切换到中文</button>
    </div>
  );
}
```

### Convenience Hook: `useTranslation`

If you only need the translation function:

```tsx
import { useTranslation } from '../i18n';

function MyComponent() {
  const { t } = useTranslation();

  return <button>{t('common.save')}</button>;
}
```

### The `t()` Function

```tsx
// Basic usage
t('nav.home')           // Returns "Home" (en) or "首页" (zh)

// With fallback (if key not found in any language)
t('some.missing.key', 'Default Text')
```

## Adding New Translations

### Step 1: Add Keys to `translations.ts`

Add your translations to both `en` and `zh` objects:

```typescript
// src/i18n/translations.ts

export const translations = {
  en: {
    // ... existing translations

    myFeature: {
      title: 'My Feature',
      description: 'This is a new feature',
      button: 'Click me',
    },
  },

  zh: {
    // ... existing translations

    myFeature: {
      title: '我的功能',
      description: '这是一个新功能',
      button: '点击我',
    },
  },
} as const;
```

### Step 2: Use in Components

```tsx
import { useLanguage } from '../i18n';

function MyFeature() {
  const { t } = useLanguage();

  return (
    <div>
      <h1>{t('myFeature.title')}</h1>
      <p>{t('myFeature.description')}</p>
      <button>{t('myFeature.button')}</button>
    </div>
  );
}
```

## Translation Key Structure

Keys are organized by feature/page:

| Prefix | Description |
|--------|-------------|
| `common.*` | Common words (loading, cancel, save, etc.) |
| `nav.*` | Navigation labels |
| `settings.*` | Settings page |
| `themes.*` | Theme names |
| `adventure.*` | Adventure mode UI |
| `tour.*` | Guided tour/tutorial |
| `codeRunner.*` | Code runner controls |
| `blocks.*` | Block editor labels |
| `profile.*` | Profile page |
| `home.*` | Home page |
| `grades.*` | Grade/class level names |
| `battle.*` | Battle mode |
| `classroom.*` | Classroom mode |

## Type Safety

The system provides full TypeScript support with autocomplete for translation keys:

```tsx
const { t } = useLanguage();

t('nav.home');        // OK - valid key
t('nav.invalid');     // TypeScript error - invalid key
```

## Fallback Behavior

1. If a key exists in current language → returns that value
2. If key missing in current language but exists in English → returns English value
3. If key missing in both languages → returns the provided fallback or the key itself

```tsx
t('missing.key')                    // Returns "missing.key"
t('missing.key', 'Fallback Text')   // Returns "Fallback Text"
```

## Language Switching

The language preference is automatically persisted:

```tsx
const { language, setLanguage } = useLanguage();

// Switch language
setLanguage('zh');  // Switches to Chinese and saves preference

// Current language
console.log(language);  // 'en' or 'zh'
```

## Provider Setup

The `LanguageProvider` must wrap your app (already configured in `main.tsx`):

```tsx
import { LanguageProvider } from './i18n';

function App() {
  return (
    <LanguageProvider>
      <YourApp />
    </LanguageProvider>
  );
}
```

## Best Practices

1. **Always use translation keys** - Never hardcode user-facing text
2. **Keep keys organized** - Group related translations under a common prefix
3. **Add both languages** - Always add translations to both `en` and `zh`
4. **Use descriptive keys** - `adventure.levelComplete` is better than `msg1`
5. **Keep translations short** - UI text should be concise

## Example: Adding a New Page

```typescript
// 1. Add translations in translations.ts
export const translations = {
  en: {
    // ...existing
    newPage: {
      title: 'New Page',
      welcome: 'Welcome to the new page!',
      actions: {
        submit: 'Submit',
        cancel: 'Cancel',
      },
    },
  },
  zh: {
    // ...existing
    newPage: {
      title: '新页面',
      welcome: '欢迎来到新页面！',
      actions: {
        submit: '提交',
        cancel: '取消',
      },
    },
  },
};

// 2. Use in component
import { useLanguage } from '../i18n';

function NewPage() {
  const { t } = useLanguage();

  return (
    <div>
      <h1>{t('newPage.title')}</h1>
      <p>{t('newPage.welcome')}</p>
      <button>{t('newPage.actions.submit')}</button>
      <button>{t('newPage.actions.cancel')}</button>
    </div>
  );
}
```

## Adding a New Language

To add a new language (e.g., Japanese):

1. Update the `Language` type in `translations.ts`:
   ```typescript
   export type Language = 'en' | 'zh' | 'ja';
   ```

2. Add the new language object:
   ```typescript
   export const translations = {
     en: { ... },
     zh: { ... },
     ja: {
       common: {
         loading: '読み込み中...',
         // ... all other keys
       },
       // ... all other sections
     },
   };
   ```

3. Add language option in Settings page UI

---

*See also: [Architecture](./architecture.md) | [Language Design](./language.md)*
